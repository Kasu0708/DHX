<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>DHX</title>
  <meta name="viewport" content="width=1024, user-scalable=no">

  <link rel="stylesheet" href="base.css">
  <link rel="stylesheet" href="lisa.css">

</head>

<body>
	<div class="container">
		<div class="row">
			<div class="col-md-9 col-lg-9">  

<img src="infosys_vapp_est_78px.png">

<h1 id="dokumendivahetusprotokoll-dhx">Document exchange protocol DHX</h1>

<p><em>v 1.0.3</em></p>

<h2 id="sisukord">Table of Contents</h2>

<p>
  <a href="#1-Ülevaade">1 Overview</a> <br>
  <a href="#11-protokolli-k%C3%A4sitlusala">1.1 Scope of the protocol</a> <br>
  <a href="#12-dokumendi-eesm%C3%A4rk">1.2 Objective of the document</a> <br>
  <a href="#13-v%C3%A4ljat%C3%B6%C3%B6tamine">1.3 Development</a> <br>
  <a href="#14-disaini-kaalutlused">1.4 Design aspects</a> <br>
  <a href="#15-laiendatavus">1.5 Laiendatavus</a>
</p>

<p><a href="#2-nõuete-keel">2 Language of requirements</a></p>

<p><a href="#3-mõisted-ja-lühendid">3 Terms and abbreviations</a></p>

<p><a href="#4-lähteolukord">4 Initial situation</a></p>

<p><a href="#5-dhx-teenus">5 DHX service</a><br>
  <a href="#51-Üldiseloomustus">5.1 General description</a><br>
  <a href="#52-dhx-teenuse-väljaarendamine">5.2 Development of DHX service</a><br>
  <a href="#53-dhx-teenuse-avamine">5.3 Opening DHX service</a><br>
  <a href="#54-nimemuster">5.4 Name pattern</a><br>
  <a href="#55-reserveeritud-nimi-dhx">5.5 Reserved name “DHX*”</a><br>
  <a href="#56-kapsli-kasutamine">5.6 Use of capsule</a><br>
  <a href="#57-unikaalne-identifikaator">5.7 Unique identifier</a>
</p>

<p><a href="#6-vahendamine">6 Mediation</a><br>
  <a href="#61-vahendamise-mõiste">6.1 Definition of mediation</a><br>
  <a href="#62-vahendajate-nimekiri">6.2 List of intermediaries</a><br>
  <a href="#63-vahendusnimekiri">6.3 Mediation list</a><br>
</p>

<p><a href="#7-saatmine">7 Sending</a><br>
  <a href="#71-dhx-võimekus">7.1 DHX capability</a><br>
  <a href="#72-otsevõimekuse-väljaselgitamine">7.2 Identification of direct capability</a><br>
  <a href="#73-v%C3%B5imekus-l%C3%A4bi-vahendaja">7.3 Capability through intermediary</a><br>
  <a href="#74-lokaalne-aadressiraamat">7.4 Local address book</a><br>
  <a href="#75-saatmine-dvk-sse">7.5 (void)</a><br>
  <a href="#76-dokumendi-lugemine-edastatuks">7.6 Considering a document transmitted</a><br>
  <a href="#77-uuesti-üritamine">7.7 Re-attempting</a><br>
  <a href="#78-saatmisalgoritm-informatiivne">7.8 Sending algorithm (informative)</a><br>
</p>

<p><a href="#8-vastuvõtmine">8 Receiving</a><br>
  <a href="#81-aadressi-kontroll">8.1 Address check</a><br>
  <a href="#82-valest-aadressist-teatamine">8.2 Notification of wrong address</a><br>
  <a href="#83-kapsli-kontroll">8.3 Capsule check</a><br>
  <a href="#84-mitme-aadressi-käsitlus">8.4 Handling multiple addresses</a><br>
  <a href="#85-vastuvõtmine-dvk-st">8.5 Reception from DEC</a><br>
  <a href="#86-saatja-kindlakstegemine">8.6 Identification of sender</a><br>
</p>

<p><a href="#9-üleminek">9 Transition</a><br>
  <a href="#91-üleminekuperiood">9.1 Transition period</a><br>
  <a href="#92-dvk-toimimine-üleminekuperioodil">9.2 Functioning of DEC in transition period</a><br>
</p>

<p><a href="#10-vastavusn%C3%B5uded">10 Conformance criteria</a>  </p>

<p><a href="#viited">References</a></p>

<p><a href="#lisa-1-senddocument-spetsifikatsioon">Appendix 1 sendDocument specification</a></p>

<p><a href="#lisa-2-representationlist-spetsifikatsioon">Appendix 2 representationList specification</a></p>

<p><a href='#lisa-3-muutelugu'>Appendix 3 Change history</a></p>

<p>Figures: <br>
Figure 1 <a href="#4-lähteolukord">Initial situation: document exchange via DEC</a> <br>
Figure 2 <a href="#5-dhx-teenus">Basic scheme of DHX</a> <br>
Figure 3 <a href="#6-vahendamine">DHX service mediation</a> <br>
Figure 3a <a href="#55-reserveeritud-nimi-dhx">Mitme alamsüsteemi kasutamine</a> <br>
Figure 4  <a href="#9-Üleminek">Functioning in transition period</a> </p>

<h2 id="1-ülevaade">1 Overview</h2>

<h3 id="11-protokolli-käsitlusala">1.1 Scope of the protocol</h3>

<p>Document exchange protocol DHX is a standardised technical and organisational solution, enabling institutions to exchange documents, based on a distributed or decentralised principle.</p>

<p>DHX enables the decentralised organisation of electronic document exchange, without the need for a central post-processing unit. Unlike the old document exchange centre (DEC), DHX does not require visiting “the post office” any longer from document management systems (DMS), but ensures the transmission of documents directly from the sender to the recipient.</p>

<p>The protocol does not require individual (bilateral) agreements, configurations, building of interfaces, etc. between institutions that exchange documents. An institution following the protocol may send a document to another institution without previous communication between the two institutions.</p>

<p>DHX is intended mainly for the safe and cost-efficient organisation of the public sector’s document exchange, but the scheme can also be expanded to organisations of private and free sectors.</p>

<p>DHX supports the mediation of a data service (within the meaning of X-Road).</p>

<p>DHX uses the X-Road infrastructure.</p>

<p>The protocol presumes the motivation of the implementing parties for the efficient and safe organisation of document exchange: will of the sender to send documents, and will of the recipient to receive documents.</p>

<h3 id="12-dokumendi-eesmärk">1.2 Objective of the document</h3>

<p>This document specifies the conformity requirements, data formats, the processing and procedural logic for all parties related to the implementation of DHX – institutions implementing DHX, the intermediaries of DHX and the X-Road Centre. It also covers transition from the former DEC-based document exchange to the use of DHX.</p>

<h3 id="13-väljatöötamine">1.3 Development</h3>

<p>The compilation of the protocol is based on the best practice in protocol specification [RIA-PP].</p>

<p>The protocol has been designed as an open standard.</p>

<div class="note">Note (informative). <br>
The Internet Engineering Task Force IETF ([RFC 6852]) has set the following criteria for an open standard: <br>
- due process: <br>
  - decisions are made with equity and fairness among participants <br>
  - the standards process is transparent <br>
    - record of discussions <br>
    - public comment period is provided before final approval and adoption <br>
    - processes for periodic review and updating are well defined <br>
- broad consensus <br>
- transparency <br>
- balance – standardisation activities are not exclusively dominated by any particular person, company or interest group <br>
- voluntary adoption. IETF has the opinion that success of a standard is determined by the market.</div>

<p>The protocol has been developed by the Information System Authority.</p>

<p>Proposals and recommendations submitted in the report of the analysis conducted in May–June 2016 within the framework of the project „Development of transfer of the document exchange infrastructure to a distributed architecture“ (performed by BPW Consulting OÜ) have been taken into account in the protocol. </p>

<p>Please send any proposals and comments to help@ria.ee or create <code>Issue</code> in this repository.</p>

<p>The protocol can be used with the MIT licence [MIT].</p>

<p>To verify the quality and feasibility of the protocol, <a href='https://dhxdemo.eesti.ee/'>a reference implementation</a> has been developed.</p>

<p>Working documents and background information from the protocol development process can  be accessed at <a href='https://github.com/e-gov/DHX'>https://github.com/e-gov/DHX</a>.</p>

<h3 id="14-disaini-kaalutlused">1.4 Design aspects</h3>

<p>The protocol has been designed based on the business requirements set to a distributed document exchange solution:</p>

<ul>
<li><strong>distribution</strong> - the solution may not require a central node or any other central components, except options offered by the X-Road infrastructure (the X-Road identification and addressing system, X-Road meta services).</li>
<li><strong>deliverability</strong> - the solution must enable guaranteed delivery of documents to all institutions using X-Road, who adopt DHX.</li>
<li><strong>addressability</strong> - a sender must be able, based on the name of the addressee, to find easily the address, where to send the document.</li>
<li><strong>security</strong> - a sent document must reach the correct addressee and only them.</li>
<li><strong>fast</strong> - time of delivery of the document must be short, not longer than in a DEC solution.</li>
<li><strong>legal</strong> - the solution must meet valid legislation, or realistic proposals are submitted for amending the law.</li>
<li><strong>simple</strong> - the technical implementation must be simple, any development tasks required in DMSs must be performed at a minimum cost.</li>
<li><strong>low operation costs</strong> - the solution may not set an additional system administration burden to DMS administrators.</li>
<li><strong>enabling the traffic of e-invoices</strong> - the solution must retain similar e-invoice processing possibilities as the former DEC.</li>
<li><strong>agnostic against the document type</strong> - the protocol may not set restrictions on the type of exchanged documents, except on the use of the document exchange “capsule“ (see [DHX]).</li>
<li><strong>minimal</strong> - the protocol may not include elements with low significance for the fulfilment of business requirements.</li>
<li><strong>base layer capacity</strong> - it must be possible to establish further agreements on the protocol.</li>
<li><strong>supporting X-Road version 6</strong> - the protocol must function in X-Road version 6; support of former versions of X-Road is not required.</li>
<li><strong>smooth transition</strong> - the transition to a distributed solution must be planned from a technical as well as organisational point of view; the transition must be smooth; transition risks must be managed with relevant measures.</li>
<li><strong>satisfaction of statistical need</strong> - the information needs of various users of the statistics of the document exchange must be taken into account.</li>
<li><strong>preservation of convenience</strong> - the current convenience of use of DEC for the user must be preserved (may improve) during the use of DHX and the transition period.</li>
</ul>

<p>A balanced solution is sought in the case of conflicting business requirements. </p>

<h3 id="15-laiendatavus">1.5 Extendability</h3>

<div class='note'>
<p>Note (informal). Development of the protocol aims to create a stable, long-term solution to concrete, important business needs. Nevertheless, possible change of the business needs and also change in substrata of the protocol (X-Road, document exchange capsule) in the future has to be accounted for. Also, one has to consider that protocol users may have special requirements that cannot be met with general rules, but what can be solved with local agreements by narrower user groups. Therefore, the established good practice is to offer extension mechanisms in data exchange protocols. (see, e.g. [HTML5]).</p>
</div>

<p>DHX protocol supports extendability by stipulating one extendability principle and two specific mechanisms:</p>

<p><strong>Principle of layering</strong>. Consciously have been avoided solving problems that can be solved more suitably in some other layer of the protocol stack. Also, dependencies from adjoining layers have tried to be minimised - by using only these elements of adjoining layers the use of which is justified.</p>

<p><strong>Versioning</strong>. We foresee the possibility that the protocol will be amended or updated in future. Amending must be very infrequent and strongly justified. To allow amending, the protocol is versioned. Semantic versioning pattern [SEMVER] is used. The first officially published version is 1.0.</p>

<p class="advisement">The system that sends the document MUST specify the version of the DHX protocol used.</p>

<p><strong>User-specific elements in messages</strong>. Protocol offers a mechanism for using additional parameters both in query message that sends the document, and in the response message. For specifics see specification of service  <code>sendDocument</code> in Appendix 1.</p>

<h2 id="2-nõuete-keel">2 Language of requirements</h2>

<p>This text, including the appendices, has a normative meaning, except the sections with the note “informative”. The other content of theGitHub repository has an informative meaning.</p>

<p>Words in capital letters must be interpreted as follows (see [RFC 2119]):</p>

“MUST”, “MAY ONLY” – the implementer of the protocol cannot declare conformity to the protocol if the requirement is not fulfilled.
“SHOULD” – the requirement must not necessarily be implemented, but the implementation can be considered conforming to the protocol only if there is a sound reason for deviation from the fulfilment of the requirement.
“MAY” – a property may be implemented; non-implementation need not be explained.

<h2 id="3-mõisted-ja-lühendid">3 Terms and abbreviations</h2>

<table>
<thead>
<tr>
  <th>term</th>
  <th>explanation</th>
</tr>
</thead>
<tbody><tr>
  <td><em>addressee</em></td>
  <td>An institution, to whom the document is intended to be sent. An addressee is unambiguously determined by the registry code of the institution. Synonymous to the word “recipient”.</td>
</tr>
<tr>
  <td><em>institution</em></td>
  <td>An organisation participating in DHX document exchange. Mainly a public sector institution of Estonia, but can also be a free sector company or organisation. The institution must be entered into the official register (national register of state and local government (RKOARR), commercial register, non-profit associations and foundations register) and must have a registry code.</td>
</tr>
<tr>
  <td><em>DHX document exchange</em></td>
  <td>Exchange of documents on X-Road pursuant to the DHX protocol.
DHX direct implementation Implementation of DHX directly, i.e. without an intermediary.</td>
</tr>
<tr>
  <td><em>DHX-i direct implementation</em></td>
  <td>Implementation of DHX directly, i.e. without an intermediary.</td>
</tr>
<tr>
  <td><em>DHX-i direct capability</em></td>
  <td>If an institution has created a capability to implement DHX without an intermediary, then the institution has DHX direct capability.</td>
</tr>
<tr>
  <td><em>DHX implementer</em></td>
  <td>An institution using DHX.</td>
</tr>
<tr>
  <td><em>DHX implementation</em></td>
  <td>The use of DHX, fulfilling all conformity requirements of DHX. DHX may be implemented directly or via an intermediary.</td>
</tr>
<tr>
  <td><em>DHX capability through intermediary</em></td>
  <td>The use of DHX-i via an intermediary. See DHX direct implementation.</td>
</tr>
<tr>
  <td><em>DHX capability</em></td>
  <td>The capability of an institution to send and receive documents according to the DHX protocol. DHX capability can be executed directly (see DHX direct capability) or via an intermediary (see DHX capability through an intermediary).</td>
</tr>
<tr>
  <td><em>DHX service</em></td>
  <td>The X-Road service with a standard name pattern <code>EE/GOV/<registry code>/DHX/sendDocument</code>, through which a direct implementer or intermediary of DHX receives documents.</td>
</tr>
<tr>
  <td><em>DHX mediation</em></td>
  <td>The usage pattern of X-Road, where an X-Road member with the role of an intermediary (DHX intermediary) enables an institution to access the DHX document exchange via their information system. See DHX direct implementation.</td>
</tr>
<tr>
  <td><em>DHX intermediary</em>, longer term <em>DHX document exchange service intermediary</em>, shortly <em>intermediary</em></td>
  <td>An X-Road member who provides service to an institution, mediating DHX document transmission. Typically, a provider of the DMS cloud or an accommodation service; may be a service provider of the private sector or institution of the public sector, providing service to another institution.</td>
</tr>
<tr>
  <td><em>DHX intermediary group</em></td>
  <td>Technical means for maintaining the list of DHX intermediaries. The DHX intermediary group is part of the X-Road global configuration.</td>
</tr>
<tr>
  <td><em>DHX intermediary list</em></td>
  <td>List of intermediaries of the DHX document exchange service maintained by the X-Road Centre (RIA).</td>
</tr>
<tr>
  <td><em>DMS cloud service</em></td>
  <td>Relationship, whereby one organisation (a company or another institution) provides an institution with the DMS technical environment. There may be several “virtual” DMSs in one technical environment. For example, the Ministry of Economic Affairs and Communications provides a DMS service to institutions under the administration of the ministry; the Information System of Estonian Schools (EKIS) provides the DMS service to several kindergartens. DMS cloud service and DHX mediation may be joined, but are still separate terms. Accommodation provider may not always be an intermediary. There is a mediation relationship, when X-Road traffic takes place with the certificate of the intermediary.</td>
</tr>
<tr>
  <td><em>document</em></td>
  <td>A document processed in an institution within the meaning of document management in the Estonian public sector. May include several files. Transmitted in a capsule of electronic document exchange.</td>
</tr>
<tr>
  <td><em>document management system</em>, <em>DHS</em></td>
  <td>An information system for electronic document management within an institution, incl. for servicing document exchange.</td>
</tr>
<tr>
  <td><em>capsule of electronic document exchange</em></td>
  <td>“Capsule” in short – XML structure containing document and metadata.</td>
</tr>
<tr>
  <td><em>global configuration</em></td>
  <td>A set of X-Road metadata, list of members, subsystems and groups of X-Road. See [PR-GCONF], [PR-META].</td>
</tr>
<tr>
  <td><em>DEC</em></td>
  <td>Document Exchange Centre [DEC].</td>
</tr>
<tr>
  <td><em>RIA</em></td>
  <td>Information System Authority.</td>
</tr>
<tr>
  <td><em>registry code</em></td>
  <td>The official registry code of an institution, e.g. <code>70002093</code> <code>Kadriorg kindergarten</code>.</td>
</tr>
<tr>
  <td><em>receiving system</em></td>
  <td>An information system receiving a document on X-Road according to the DHX protocol (may be also an information system of an intermediary and DEC in the transition period).</td>
</tr>
<tr>
  <td><em>consignment</em></td>
  <td>A document that the sending system tries to send to the receiving system. Several attempts are made in the case of failure.</td>
</tr>
<tr>
  <td><em>consignment id</em></td>
  <td>A unique identifier assigned to the series of attempts to send a document. See 7.7.</td>
</tr>
<tr>
  <td><em>receiver</em></td>
  <td>An institution, to whom the document has been addressed. Has a similar meaning with the word “addressee”. In the case of mediation, also an intermediary can be considered a receiver. It must always be clear from the text which one is meant. See "sender".</td>
</tr>
<tr>
  <td><em>sender</em></td>
  <td>An institution sending a document; the sender may use an intermediary. In the case of mediation, also an intermediary can be considered the sender. It must always be clear from the text which one is meant. See “receiver”.</td>
</tr>
<tr>
  <td><em>sending system</em></td>
  <td>An information system sending a document on X-Road according to the DHX protocol (may also be an information system of an intermediary).</td>
</tr>
<tr>
  <td><em>service identifier</em></td>
  <td>An X-Road service identifier under the requirements of X-Road [X-Road] version 6. Uniquely identifies the X-Road service both on the Estonian X-Road and in the international network of X-Road implementations. Consists of an X-road member identifier, a service code denomination and an optional version number. For example: <code>EE/GOV/70003158/DHX/sendDocument</code>.</td>
</tr>
<tr>
  <td><em>intermediary</em></td>
  <td>See “DHX intermediary”.</td>
</tr>
<tr>
  <td><em>intermediated</em></td>
  <td>An institution, who has created DHX capability via an intermediary. Does not participate in DHX document exchange on X-Road with their certificate, but uses the service of an intermediary.</td>
</tr>
<tr>
  <td><em>mediation list</em></td>
  <td>The list of institutions mediated by an intermediary of the DHX document exchange service, offered by them on X-Road as a service. Do not confuse with the DHX intermediary list.</td>
</tr>
<tr>
  <td><em>transition period</em></td>
  <td>The period of transition from the use of Document Exchange Centre (DEC) to the use of DHX. The X-Road Centre specifies the beginning and the end of the period.</td>
</tr>
<tr>
  <td><em>X-Road Centre</em></td>
  <td>X-Road administrator. RIA has the role of the X-Road Centre. The X-Road Centre registers the X-Road sybsystems “DHX” and maintains the DHX intermediary list.</td>
</tr>
</tbody></table>

<h2 id="4-lähteolukord">4 Initial situation</h2>

<p>Currently, DMSs exchange documents via DEC, by using the tentatively named “DEC protocol”. The “DEC protocol” is determined by the list of electronic data exchange meta data [Capsule], the specification of DEC interfaces [DEC specification ] and [DEC maintenance procedure], and, in a broader context, “Common Principles of Administrative and Records Management Procedures” [AÜK]. To a smaller degree, document exchange interfaces have also been established between other information systems that process documents. These interfaces have not been standardised. The extending document circulation and the tightening network of information systems that exchange documents (modern document exchange is not limited to the so-called pure DMSs – documents are also exchanged by information systems, where document management in the traditional meaning is simply one type of data processing) call for an alternative to the document circulation occurring via a central mailbox server.</p>

<p><img src="DHX-Initial02.PNG" alt="" title=""></p>

<p>Joonis 1. Initial situation: document exchange via DEC</p>

<h2 id="5-dhx-teenus">5 DHX service</h2>

<h3 id="51-üldiseloomustus">5.1 General description</h3>

<p>The DHX service is an X-Road service with a standard name pattern and processing logic, enabling an institution to send documents to another institution.</p>

<p><img src="DHX-TOBE02.PNG" alt="" title=""></p>

<p>Joonis 2. Basic scheme of DHX</p>

<p>The use of the DHX service is an interaction, where two messages are sent: <br>
 - the sender of the document sends an X-Road query message (query) to the service sendDocument <br>
 - the receiver of the document sends a response message, confirming the receipt of the document.</p>

<div class="note">Note. Query and response messages form a synchronous <em>request-response</em> message pair used as a standard on X-Road.  </div>

<p>If a document has been incorrectly addressed or formed, a relevant error message is sent in the response message.</p>

<p>A document is transmitted in the query message.</p>

<p>Documents are transmitted with the push method. The sender of the document initiates sending by addressing the <code>sendDocument</code> service of the addressee.</p>

<h3 id="52-dhx-teenuse-väljaarendamine">5.2 Development of the DHX service</h3>

<p class="advisement">An institution implementing DHX (or their DMS mediation service or DMS accommodation service provider) MUST develop the DHX service in their DMS and operate it.</p>

<p>The protocol does not exclude situations, where only a sending or receiving capability meeting the requirements of DHX protocol is established in DMS. Technically, there are no constraints. As the business need of such asymmetric solutions is unclear, proceeding from the objective to maintain simplicity, the protocol does not specify separate profiles for the systems limited to sending or reception.</p>

<p class="advisement">DHX-i rakendav asutust VÕIB DHX-i võimekuse luua ka enamas kui ühes oma infosüsteemis.</p>

<p class="advisement">DHX service performed by a DHX implementer MUST meet the detailed specification provided in Appendix 1.</p>

<h3 id="53-dhx-teenuse-avamine">5.3 Opening a DHX service</h3>

<p class="advisement">An institution implementing DHX MUST open the DHX service to all institutions with whom they want to exchange documents. If an institution does not want to open a DHX service to all members of X-Road due to security policy or other reasons, they MAY open a DHX service to specific members of X-Road (with granting access rights in the X-Road security server).</p>

<p>DHX is intended primarily as a universal document exchange agreement.</p>

<p class="advisement">For the transition period, DHX service MUST be opened also to DEC.</p>

<p>DEC transmits documents from institutions who have not yet established DHX capability.</p>

<h3 id="54-nimemuster">5.4 Name pattern</h3>

<p class="advisement">The name of the DHX service MUST follow the pattern <code>EE/&lt;member class&gt;/&lt;registry code&gt;/&lt;DHX*&gt;/sendDocument</code>, wheres<br>
 - <code>EE</code> is the name of the Estonian X-Road instance; <br>
 - <code>&lt;member class&gt;</code> is the member class of X-Road (depending on the legal form of the intermediary, either <code>GOV</code> or <code>PRI</code>);<br>
 - <code>&lt;DHX*&gt;</code> is the name of the X-Road subsystem ensuring detection of the service, fixed with this protocol in form <code>DHX*</code>, i.e. three inital symbols of the name MUST be <code>DHX</code>. Fixed initial symbols MAY be followed by more symbols, i.e. name MUST begin with <code>DHX</code>, but CAN be longer. If institution employes DHX only in one information system (in institution's DMS), then <code>DHX</code> is sufficient for X-Road subsystem name. However, if institution wants to employ DHX in more that ine information system., then different sybsystem names MUST be chosen.<br>
 - <code>&lt;registrikood&gt;</code> is the registry code of the institution.</p>

<div class="example">Examples:<br>
 <code>EE/GOV/70003158/DHX/sendDocument</code><br>
 <code>EE/GOV/70000906/DHX.viru/sendDocument</code> (Viru Regional Prosecutor's Office)<br>
 <code>EE/GOV/70000906/DHX.laane/sendDocument</code> (Lääne Regional Prosecutor's Office)<br>
 (Regional Prosecutor's Offices are not independent institutions but subunits of  Prosecutor's Office.)
</div>

<h3 id="55-reserveeritud-nimi-dhx">5.5 Reserved name DHX*</h3>

<p class="advisement">DHX service MUST use the X-Road subsystem name <code>DHX*</code>, where <code>*</code> is a sequence of symbols that can be empty. The X-Road Centre MAY NOT register the subsystem “DHX” of any institution for another purpose</p>

<p class="advisement">If institution employs DHX only in one of its information systems (in institution's DMS), then X-Road subsystem name code>DHX</code> SHOULD be used (and not a longer name).</p>

<div class='note'>
  <p>Note (informative). Information system may provide services other than DHX document exchange under subsystem name <code>DHX*</code>. Nevertheless, wider use of the name DHX can cause a need for unnecessary communication or even confusion. Therefore, if information system has besides DHX protocol data traffic other data traffic in X-Road, then it can be suitable to bind more than one X-Road subsystem to the information system.</p>
  <p>For example, figure 3a represents an information system - <code>ADIT</code> - that is bound to two X-Road subsystems: 1) DHX data traffic flows through <code>DHX-ADIT</code>; 2) other X-Road services are provided and consumed through <code>ADIT</code>.</p>
  <p>Usage of multiple subsystems does not cause additional costs (no separate sertificates are needed). Subsystems can be viewed as logical access points or gates.</p>
</div>  

<p><img src="DHX-Subsystems.PNG" alt="" title=""></p>

<p>Joonis 3a Use of multiple subsystems</p>

<h3 id="56-kapsli-kasutamine">5.6 Use of capsule</h3>

<p class="advisement">Document MUST be transmitted in a “capsule” complying with the officially confirmed list of digital data exchange metadata [Capsule].</p>

<p>The registry code of the addressee-institution is also forwarded in the capsule of the document.</p>

<div class="issue">Upon the adoption of DHX, a need arises to specify the meaning of elements of metadata of a capsule [Capsule] or an event to issue a new version. It is probably practical to issue a new version after the end of the transition period to DHX (when DEC is ultimately decommissioned).</div>

<p>The table below provides a commented list of elements of the capsule affected by the adoption of DHX. The complete specification of elements of the capsule is provided in [Capsule].</p>

<table>
<thead>
<tr>
  <th>element</th>
  <th>meaning upon use of DHX</th>
</tr>
</thead>
<tbody><tr>
  <td>Transport  1. DEC Sender</td>
  <td>Transport  1. Sender of the document</td>
</tr>
<tr>
  <td>Transport  2. DEC Receiver</td>
  <td>Transport  2. Receiver of the document</td>
</tr>
<tr>
  <td>XI DEC document metadata</td>
  <td><em>n/a</em></td>
</tr>
</tbody></table>
</h2>

<h3 id="57-unikaalne-identifikaator">5.7 Unique identifier</h3>

<p class="advisement">The sending system MUST assign a unique identifier to the series of attempts to send document (<code>consignment id</code>). (See also Section 7.7 Re-attempting).</p>

<h2 id="6-vahendamine">6 Mediation</h2>

<h3 id="61-vahendamise-mõiste">6.1 Definition of mediation</h3>

<p>In the case of mediation, an intermediary provides the service of sending and receiving documents on X-Road to an institution. The institution does not communicate with X-Road in the DHX context themselves. The institution even need not to be an X-Road member. The intermediary uses their name on X-Road. An intermediary may be a company of private sector as well as an institution of public sector.</p>

<p><strong>An institution MAY implement DHX directly (i.e. independently) or via an intermediary</strong></p>

<div class="note">
  <p>Note (informative). Mediation differs from accommodation. Many institutions accommodate their DMSs at the providers of accommodation and cloud services. Accommodation may cover the accommodation of the X-Road security server as well as DMS (provision of cloud service). From the standpoint of DHX, it is important whether DMS of an institution communicates on X-Road using the X-Road certificate of the institution or not. All relationships, where communication on X-Road takes place with the X-Road certificate of the service provider instead of the X-Road certificate of the institution, are considered mediation.</p>

  <p>In the case of accommodation, fulfilment of the requirements of this protocol must be ensured the upon implementation of DHX. The method depends on the specific relationship between the accommodation service provider and the institution, and is not covered by the scope of this protocol.</p>
</div>

<p>Upon the mediation of DHX, an intermediary develops the DHX service, opens it to other institutions and then operates it. Figure 3 includes the scheme of interaction principles in the case of mediation.</p>

<p><img src="DHX-Vahendamine01.PNG" alt="" title=""></p>

<p>Joonis 3 Mediation of DHX service</p>

<p>Requirements proceeding from the X-Road regulation are set to mediation: obligation to register on X-Road as an intermediary, obligation to develop and publish the procedure (policy) for data service mediation, etc. (see [X-Road regulation] § 13).</p>

<h3 id="62-vahendajate-nimekiri">6.2 List of intermediaries</h3>

<p class="advisement">Upon the implementation of DHX via an intermediary, the institution MUST conclude a contract with the DHX intermediary. They MAY ONLY use the intermediaries entered into the list of DHX intermediaries by the X-Road Centre.</p>

<p>The list of intermediaries is the list of intermediaries of the DHX document exchange service.</p>

<p>The list of intermediaries is maintained by the X-Road Centre (RIA).</p>

<p>Technically the list of intermediaries is executed as a DHX intermediary group. DHX intermediary group is part of the X-Road global configuration. As such, the list of intermediaries is available to all X-Road members. </p>

<p class="advisement">An institution or a company intending to operate as an intermediary MUST register themselves on X-Road as intermediaries. Specific registration procedure is established by the X-Road Centre.</p>

<p class="advisement">The X-Road Centre MUST maintain an updated list of DHX intermediaries.</p>

<h3 id="63-vahendusnimekiri">6.3 Mediation list</h3>

<p>The mediation list is a list of institutions mediated by an intermediary and maintained by an intermediary.</p>

<p class="advisement">An intermediary MUST maintain mediation list.</p>

<p class="advisement">Vahendaja PEAB hoidma vahendusnimekirja autentsena ja ajakohasena.</p>

<p>An intermediary MUST keep the mediation list authentic and updated. Authenticity means that the mediation list must present mediation relationships correctly and completely. Updating means that the mediation list must present all valid mediation relationships at every given moment.</p>

<p>The mediation list MAY include information about expired or future mediation relationships (presented with fields <code>startDate</code> and <code>endDate</code>).</p>

<p class="advisement">An intermediary MUST make the mediation list available as an X-Road service.</p>

<p class="advisement">The name of the mediation list service MUST follow the pattern  <code>EE/&lt;member class&gt;/&lt;registry code&gt;/DHX/representationList</code>, where <br>
 - <code>EE</code> is the name of the Estonian X-Road instance <br>
 - <code>&lt;liikmeklass&gt;</code> is a member class of X-Road (value according to X-Road protocol – depending on the legal form of intermediary, either <code>GOV</code>, <code>COM</code>, <code>NGO</code> or <code>NEE</code>)  <br>
 - <code>DHX</code> is the name of X-Road subsystem ensuring the detection of the service, fixed with this protocol, and <br>
 - <code>&lt;registrikood&gt;</code> is the registry code of the institution.</p>

<p>Example: <code>EE/COM/40001111/DHX/representationList</code></p>

<p class="advisement">The mediation list service provided by a DHX implementer MUST meet the detailed specification provided in Appendix 2.</p>

<h2 id="7-saatmine">7 Sending</h2>

<h3 id="71-dhx-võimekus">7.1 DHX capability</h3>

<p class="advisement">The sending system MUST find out if the adressee has DHX capability.</p>

<p>DHX capability may be a direct capability or capability through an intermediary.</p>

<div class="note">Note (informative). It possible to speak more specifically of <em>DHX sending capability</em> and <em>DHX reception capability</em>. DHX does not require symmetrical implementation: there are no technical restrictions to the establishment of only sending DMS or only receiving DMS. However, the use case of such solutions is not clear. Setting the requirement of symmetrical capability is an administrative decision and remains outside the scope of this protocol. The protocol presumes that when choosing the extent of implementation of the protocol, parties proceed from real need to send and receive documents.</div>

<h3 id="72-otsevõimekuse-väljaselgitamine">7.2 Identification of direct capability</h3>

<p class="advisement">Direct capability MUST be identified as a first priority (before the identification of capability through an intermediary).</p>

<p class="advisement">The sending system SHOULD determine direct capability, based on the global configuration file of X-Road.</p>

<p>The availability of the DHX subsystem in the institution is the marker of direct capability.</p>

<p>The global configuration MAY BE downloaded from the X-Road Centre, or the global configuration file downloaded by the X-Road security server, offered by the security server interface, MAY BE used.</p>

<p>If the sending system considers the identification of DHX direct capability based on the global configuration file of X-Road technically too complicated, direct capability MAY BE also checked with a direct sending attempt.</p>

<p>If the security server answers that the addressee does not have a DHX subsystem, it can be concluded that the addressee is lacking DHX direct capability.</p>

<p>The security server of the sender downloads periodically information about the X-Road configuration from the X-Road central server [PR-GCONF], including information about the subsystems and security servers specified by the X-Road members. Based on this configuration information, security server of the sender determines whether the addressee has specified the DHX subsystem. If not, then DHX capability is lacking.</p>

<p class="advisement">If the addressee has direct capability, the document MUST BE sent directly to the addressee.</p>

<h3 id="73-võimekus-läbi-vahendaja">7.3 Capability through intermediary</h3>

<p class="advisement">When direct capability is lacking, the sending system MUST check whether the addressee has DHX capability through an intermediary.</p>

<p class="advisement">In order to check DHX capability through an intermediary, the sending system MUST:<br>
 - download the X-Road global configuration file from the X-Road Centre or use the global configuration file downloaded by the security server; <br>
 - find the list of intermediaries in the file (DHX intermediary group); <br>
 - check all intermediaries and request mediation lists via X-Road; <br>
 - find out whether the addressee is included in the mediation lists; <br>
 - check the validity of mediation relationship (with fields <code>startDate</code> and <code>endDate</code> of the response message of the service <code>representationList</code>).</p>

<p class="advisement">If the addressee has no DHX direct capability, but has DHX capability through an intermediary, the sending system MUST send the document to the intermediary.</p>

<h3 id="74-lokaalne-aadressiraamat">7.4 Local address book</h3>

<p class="advisement">The sending system MAY buffer the result of identification of DHX capability, forming a so-called local address book. It MUST be possible to configure the updating period of the buffer (local address book).</p>

<h3 id="75-saatmine-dvk-sse">7.5 (void)</h3>

<h3 id="76-dokumendi-lugemine-edastatuks">7.6 Considering a transmitted document</h3>

<p class="advisement">The sending system MUST consider the transmitted document, when the response message with a positive response code has been received from the <code>sendDocument</code> service.</p>

<p>A confirmation of receipt of the document is sent in the response message of a <em>request</em>-<em>response</em> message pair of X-Road. If the parties need confirmations of higher level business logic layer, these can be realised outside the DHX protocol or as cover layer of DHX protocol.</p>

<h3 id="77-uuesti-üritamine">7.7 Re-attempting</h3>

<p class="advisement">If contact is not established with the addressee or no confirmation of receipt is received, sending MUST BE attempted again after some time.</p>

<div class="note">ote (informative). When performing re-sending, the logic used in DMSs interfaced with DEC can be taken as a comparison.</div>

<p class="advisement">In order to minimise the number of void queries, the exponential back-off algorithm [EXP] SHOULD be used.</p>

<p class="advisement">The number of sending attempts MUST be finite and possible to determine in the configuration of the sending system.</p>

<h3 id="78-saatmisalgoritm-informatiivne">7.8 Sending algorithm (informative)</h3>

<p>The following sending algorithm illustrates a possible way of performing the sending of a document programmatically. The constructions of Go language [GOLANG] have been used in the algorithm. The algorithm has an informative meaning. The implementer of the protocol may fulfil the sending requirements in a way chosen by themselves. The algorithm does not cover the preparation of a capsule.</p>

<ul>
<li>Funktsioon <code>adressaat_kasutab_DHXi_otse</code> selgitab välja, kasutades X-tee globaalset konfiguratsiooni, kas asutusel <code>a</code> on DHX-i otsevõimekus.</li>
<li>Funktsioon <code>adressaat_kasutab_vahendajat</code> selgitab välja, kasutades X-tee gruppi <code>DHX vahendajad</code> ja vahendajate X-tee teenuseid <code>representationList</code>, kas asutus <code>a</code> kasutab DHX-i teenusevahendajat.</li>
<li>Funktsioon <code>yritaSaata</code> üritab saata dokumenti <code>d</code> X-tee liikme <code>vastuvõtja</code> alamsüsteemi <code>DHX</code> teenusele <code>sendDocument</code>. Kui saatmine õnnestub, siis tagastab <code>true</code>.</li>
<li>Funktsioon <code>vahendaja_registrikood</code> leiab asutuse <code>a</code> vahendaja registrikoodi.</li>
<li>Funktsiooni <code>saadaDokument</code> kutsub välja ülalnimetatud funktsioone ja korraldab dokumendi <code>d</code> saatmise adressaadile registrikoodiga <code>a</code>. Tehakse kolm saatmisüritust, teist korda üritades peetakse vahet üks tund ja kolmandat korda üritades üks ööpäev.  </li>
</ul>

<pre class="prettyprint"><code class="language-Go hljs livecodeserver"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">saadaDokument</span>(<span class="hljs-title">d</span> <span class="hljs-title">Dokument</span>, <span class="hljs-title">a</span> <span class="hljs-title">Registrikood</span>) {</span>
    var vastuvotja<span class="hljs-comment"> // asutus, kellele süsteemile dokument teele panna (v.o vahendaja)</span>
    var saatmisyritus = <span class="hljs-number">0</span><span class="hljs-comment"> // saatmisürituse järjenumber</span>
    var maksimaalseltSaatmisyritusi = <span class="hljs-number">3</span><span class="hljs-comment"> // väärtus p.o konfigureeritav</span>

   <span class="hljs-comment"> // kõigepealt selgitatakse välja, kas adressaat rakendab DHX-i otse</span>
    <span class="hljs-keyword">if</span> adressaat_kasutab_DHXi_otse(<span class="hljs-operator">a</span>) { 
      vastuvotja = <span class="hljs-operator">a</span>
   <span class="hljs-comment"> // kui otse ei rakenda, siis kas vahendaja kaudu?  </span>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> adressaat_kasutab_vahendajat(<span class="hljs-operator">a</span>) {  
      vastuvotja = vahendaja_registrikood(<span class="hljs-operator">a</span>)
   <span class="hljs-comment"> // kui DHX-i võimekus puudub, siis üleminekuperioodil proovitakse saata veel DVK-sse  </span>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> yleminekuperiood_kestab() { 
      vastuvotja = DVK
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-constant">return</span> <span class="hljs-string">"Ei saa saata."</span> 
    }

   <span class="hljs-comment"> // saatmisüritused</span>
    <span class="hljs-keyword">for</span> saatmisyritus &lt; maksimaalseltSaatmisyritusi {
      saatmisyritus = saatmisyritus + <span class="hljs-number">1</span>
     <span class="hljs-comment"> // Viivitusaeg enne saatmisürituse kordamist</span>
      <span class="hljs-keyword">if</span> saatmisyritus == <span class="hljs-number">2</span> {
        <span class="hljs-built_in">time</span>.Sleep(<span class="hljs-built_in">time</span>.Hour)
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> saatmisyritus == <span class="hljs-number">3</span> {
        <span class="hljs-built_in">time</span>.Sleep(<span class="hljs-number">24</span> * <span class="hljs-built_in">time</span>.Hour)
      }
      <span class="hljs-keyword">if</span> yritaSaata(d, vastuvotja) {<span class="hljs-comment"> // saatmine edukas</span>
        <span class="hljs-constant">return</span> <span class="hljs-string">"Saatmine edukas"</span>
      }
    }

    <span class="hljs-constant">return</span> maksimaalseltSaatmisyritus + <span class="hljs-string">" üritust, kõik ebaõnnestusid"</span>
}</code></pre>

<h2 id="8-vastuvõtmine">8 Receiving</h2>

<h3 id="81-aadressi-kontroll">8.1 Address check</h3>

<p class="advisement">The receiving system MUST check that the document has been sent to the correct address.</p>

<p class="advisement">In the case of mediation, the receiving system MUST check whether the addressee is a customer of the intermediary (entered into the mediation list).</p>

<h3 id="82-valest-aadressist-teatamine">8.2 Notification of a wrong address</h3>

<p class="advisement">In the case of an incorrectly addressed document, the receiving system MUST send error message <code>Wrong address</code> to the sender.</p>

<h3 id="83-kapsli-kontroll">8.3 Kapsli kontroll</h3>

<p class="advisement">Vastuvõttev süsteem PEAB kontrollima, et dokument tuli nõuetekohases kapslis. Kontroll PEAB sisaldama vähemalt XML skeemile vastavuse kontrollimist. Vigase kapsli korral PEAB saatma vastava veateate <code>Vigane kapsel</code>.</p>

<p>Vastuvõttev süsteem VÕIB teha täiendavaid kontrolle semantilisel või äriloogikalisel tasandil.</p>

<h3 id="84-mitme-aadressi-käsitlus">8.4 Mitme aadressi käsitlus</h3>

<p class="advisement">Kui saatja DHS soovib dokumenti saata mitmele adressaadile (otsevõimekusega asutusele või vahendatavale asutusele) korraga, siis ta PEAB dokumendi kapsli saatma igale adresaadile eraldi, eraldi DHX <code>sendDocument</code> väljakutsega.</p>

<p class="note">Märkus (informatiivne). Kapsli saatmiseks kasutatakse adresseerimisel ainult DHX <code>sendDocument</code> teenuse parameetreid <code>memberCode</code> ja <code>recipient</code>. Kapsli enda sees määratletud täiendavad adressaadid on DHX dokumendi edastamisel informatiivse väärtusega (nagu cc väli e-kirja avamisel). Saatja DHS süsteem ei tohi eeldada, et teine otsevõimekusega adressaat edastab kapsli muudele kapslis sees toodud adressaatidele. Vahendaja kohustus on edastada kapsel ainult <code>sendDocument</code> teenuses märgitud <code>recipient</code> elemendis toodud adresaadile. Vahendaja ei pea edastama kapslit muudele kapsli sees toodud adressaatidele.</p>

<h3 id="85-vastuvõtmine-dvk-st">8.5 Vastuvõtmine DVK-st</h3>

<p class="advisement">DHX-i võimekuse loonud süsteem PEAB üleminekuperioodil dokumente vastu võtma ka DVK-st.</p>

<p>Tehniliselt seisneb see selles, et DHX-le üleläinud süsteem peab avama oma DHX teenuse ka DVK-le. DVK edastab dokumente nendelt asutustelt, kes ei ole veel DHX-le üle läinud.</p>

<h3 id="86-saatja-kindlakstegemine">8.6 Saatja kindlakstegemine</h3>

<p>Dokumendi saatja saab kindlaks teha kahel viisil: 1) dokumendi kapslis sisalduvate saatjat kirjeldavate metaandmete abil; 2) X-tee päringsõnumi X-tee päiseväljade <code>client</code> [PR-MESS] ja <code>representedParty</code> [X-EXT] abil.</p>

<div class="note">Märkus (informatiivne). Vastavalt X-tee sõnumiprotokolli kolmanda osapoole esindamise laiendusele peab vahendaja märkima asutuse, keda ta esindab, X-tee sõnumipäisesse välja <code>representedParty</code> [X-EXT].</div>

<p class="advisement">Vastuvõttev süsteem PEAB kontrollima dokumendi kapslis sisalduvate saatjat kirjeldavate metaandmete ja X-tee päringsõnumi X-tee päiseväljade <code>client</code> ja <code>representedParty</code> kooskõlalisust. Lahknevuste korral PEAB dokumendi tagasi lükkama.</p>

<p class="advisement">Vahendajalt dokumendi vastuvõtmisel PEAB kontrollima, kas vahendaja on vahendajate nimekirjas. Kontrolli tulemust VÕIB puhverdada.</p>

<h2 id="9-üleminek">9 Üleminek</h2>

<h3 id="91-üleminekuperiood">9.1 Üleminekuperiood</h3>

<p>Üleminek DHX protokollile toimub etteantud perioodi jooksul. Üleminekuperiood algab kõigile asutustele üheaegselt. Perioodi algusest teavitab X-tee keskus. Üleminekuperiood lõpeb DVK tegevuse lõpetamisega.</p>

<p>Üleminekuperioodil arendavad asutused välja oma DHS-des DHX protokolli kohase dokumentide saatmise ja vastuvõtmise võimekuse. Tehniliselt tähendab “DHX-i võimekus” DHX protokolli kohase X-tee teenuse pakkumist ja võimet teiste asutuste samasuguse teenuse poole pöörduda.</p>

<p>DHX-i võimekus ei teki asutustes üheaegselt, sest arendused valmivad erinevatel aegadel. Joonis 4 selgitab DHX-le üle läinud ja veel üle minemata süsteemide koostoimimist üleminekuperioodil.</p>

<p><img src="DHX-Yleminek-EE-02.PNG" alt="" title=""></p>

<p>Joonis 4. Toimimine üleminekuperioodil</p>

<p>Asutused 1 ja 2 on üle läinud DHX protokollile ja vahetavad dokumente üksteisega DHX-i abil otse. Asutus 3 kasutab veel vana, “DVK protokolli”.</p>

<p>DVK täidab üleminekuperioodil uue ja vana protokolli (DHX-i ja DVK) vahelise teisendaja rolli, tegutsedes DHX-i vahendajana - nende DVK klientide suhtes, kes ei ole veel DHX-i otsevõimekust loonud või teist DHX-i vahendajat valinud.</p>

<p>UK tähistab RIA poolt väljatöötatavat “universaalset tarkvarakomponenti”, mille eesmärgiks on kergendada DHS-de ümberhäälestamist DHX-i kasutamisele. UK kasutamine ei ole kohustuslik.</p>

<p class="advisement">Üleminekuperioodil niipea, kui asutuse DHS-is on tekkinud DHX protokolli võimekus (arendus on lõppenud), PEAB hakkama dokumendi saatmisel kasutama DHX teenust.</p>

<p class="advisement">Üleminekuperioodil kui osutub, et adressaat ei ole veel dokumentide vastuvõtmise DHX-teenust loonud (teenus ei ole X-teel leitav), siis PEAB dokumendi saatma DVK kaudu, kasutades DVK teenust <code>sendDocument</code> ja märkides adressaadi dokumendi metaandmete kapslis.</p>

<p class="advisement">DHX võimekuse saavutanud asutus PEAB DVK kasutamisest loobuma.</p>

<h3 id="92-dvk-toimimine-üleminekuperioodil">9.2 DVK toimimine üleminekuperioodil</h3>

<p>DVK-d hoitakse töös kogu üleminekuperioodi vältel. DVK-d täiendatakse üleminekuperioodil toimimiseks vajaliku funktsionaalsusega.</p>

<p>DVK pakub teenust <code>sendDocument</code>, millega DHX-i võimekuse loonud asutus saab edastada dokumendi edasisaatmiseks DHX võimekust veel mitteomavale asutusele. Edasisaatmise teostab DVK.</p>

<p>DVK toimib üleminekuperioodil DHX teenusevahendajana (RIA lisatakse vahendajate nimekirja).</p>

<p>DVK avaldab üleminekuperioodil teenindavate klientide (vahendatavate) nimekirja vastavalt käesolevale protokollile (teenuse <code>representationList</code> kaudu).</p>

<p>DHX-i võimekuse loonud asutusele adresseeritud dokumendi laekumisel DVK-sse üritab DVK seda kohe edasi saata.</p>

<p>DVK lülitatakse välja siis, kui kõik DVK asutused on DHX protokolli võimekuse loonud või üleminekuperioodi tähtaja saabudes.</p>

<h3 id="10-vastavusnõuded">10 Vastavusnõuded</h3>

<p>Käesolev jaotis võtab kokku nõuded (ingl <em>conformance criteria</em>, vt nt RFC 2049), mis peavad olema täidetud, et dokumente vahetava süsteemi saaks deklareerida DHX-le vastavaks.</p>

<p>Alljärgnev käsitlus piirdub koostalitlusvõimet tagavate tarkvaratehniliselt rakendatavate meetmetega ja süsteemide tehniliste omadustega. DHX dokumendivahetuse korraldamiseks võivad dokumendivahetuse osapooled ja koordinaatorid kehtestada mitmesuguseid (täiendavaid) organisatsioonilisi meetmeid. Need ei ole protokolli käsitlusalas.</p>

<h3 id="101-vastavusnõuded-kõigile-dhx-dokumente-vahetavatele-süsteemidele">10.1 Vastavusnõuded kõigile DHX dokumente vahetavatele süsteemidele</h3>

<table>
<thead>
<tr>
  <th>jaotis</th>
  <th>nõue</th>
</tr>
</thead>
<tbody><tr>
  <td>1.5</td>
  <td>Dokumenti saatev süsteem PEAB määratlema kasutatava DXH protokolli versiooni.</td>
</tr>
<tr>	
  <td>5.2</td>
  <td>DHX-i rakendav asutus (või tema DHS vahendusteenuse või DHS majutusteenuse pakkuja) PEAB arendama oma DHS-is välja DHX teenuse ja käitama seda.</td>
</tr>
<tr>
  <td>5.2</td>
  <td>DHX-i rakendaja teostatud DHX teenus PEAB vastama lisas 1 esitatud täpsemale spetsifikatsioonile.</td>
</tr>
<tr>
  <td>5.3</td>
  <td>DHX-i rakendav asutus PEAB avama DHX teenuse kõigile asutustele, kellega ta soovib dokumente vahetada. Kui asutus turvapoliitika vm kaalutlustel ei pea otstarbekaks DHX teenuse avamist kõigile X-tee liikmetele, siis VÕIB ta DHX teenuse avada konkreetsetele X-tee liikmetele (pääsuõiguste andmisega X-tee turvaserveris).</td>
</tr>
<tr>
  <td>5.3</td>
  <td>Üleminekuperioodiks PEAB DHX teenuse avama ka DVK-le.</td>
</tr>
<tr>
  <td>5.4</td>
  <td>DHX teenuse nimi PEAB järgima mustrit <code>EE/&lt;liikmeklass&gt;/&lt;registrikood&gt;/&lt;DHX*&gt;/sendDocument</code>.</td>
</tr>
<tr>
  <td>5.5</td>
  <td>DHX teenus PEAB kasutama X-tee alamsüsteemi nimega <code>DHX*</code>, kus <code>*</code> on sümbolijada, mis võib olla ka tühi.</td>
</tr>
<tr>
  <td>5.6</td>
  <td>Dokumendi PEAB edastama ametlikult kinnitatud elektroonilise andmevahetuse metaandmete loendile vastavas “kapslis”.</td>
</tr>
<tr>
  <td>5.7</td>
  <td>Saatev süsteem PEAB dokumendi saatmisürituste seeriale andma unikaalse identifikaatori (saadetise id, ingl <em>consignment id</em>).</td>
</tr>
<tr>
  <td>6.2</td>
  <td>DHX rakendamisel läbi vahendaja PEAB asutus sõlmima lepingu DHX vahendajaga. Kasutada TOHIB AINULT X-tee keskuse poolt DHX vahendajate nimekirja lisatud vahendajaid.</td>
</tr>
<tr>
  <td>7.1</td>
  <td>Saatev süsteem PEAB välja selgitama, kas adressaadil on DHX võimekus.</td>
</tr>
<tr>
  <td>7.2</td>
  <td>Otsevõimekust PEAB välja selgitama esimeses järjekorras (enne vahendaja kaudu võimekuse tuvastamist).</td>
</tr>
<tr>
  <td>7.2</td>
  <td>Saatev süsteem PEAKS otsevõimekuse välja selgitama X-tee globaalse konfiguratsioonifaili põhjal.</td>
</tr>
<tr>
  <td>7.2</td>
  <td>Adressaadil otsevõimekuse olemasolul PEAB dokumendi saatma adressaadile otse.</td>
</tr>
<tr>
  <td>7.3</td>
  <td>DHX võimekuse läbi vahendaja kontrollimiseks PEAB saatev süsteem: a) alla laadima X-tee keskusest X-tee globaalse konfiguratsiooni faili või kasutama turvaserveri poolt allalaetud globaalse konfiguratsiooni faili; b) leidma failist vahendajate nimekirja (DHX vahendajate grupi); c) käima kõik vahendajad läbi ning pärima X-tee kaudu vahendusnimekirjad; d)     kindlaks tegema, kas adressaat sisaldub vahendusnimekirjades.</td>
</tr>
<tr>
  <td>7.3</td>
  <td>Kui adressaadil puudub DHX otsevõimekus, kuid on DHX võimekus läbi vahendaja, siis PEAB saatev süsteem saatma dokumendi vahendajale.</td>
</tr>
<tr>
  <td>7.4</td>
  <td>Puhvri (lokaalse aadressiraamatu) kasutamisel PEAB värskendamise periood olema konfigureeritav.</td>
</tr>
<tr>
  <td>7.5</td>
  <td>Kui saatev süsteem on kindlaks teinud, et adressaadil puudub DHX võimekus ja käimas on üleminekuperiood, siis PEAB saatev süsteem üritama dokumenti saata DVK sendDocument teenusesse.</td>
</tr>
<tr>
  <td>7.6</td>
  <td>Saatev süsteem PEAB lugema dokumendi edastatuks, kui on saanud <code>sendDocument</code> teenuselt positiivse vastuskoodiga vastussõnumi.</td>
</tr>
<tr>
  <td>7.7</td>
  <td>Kui adressaadiga ei saa ühendust või kättesaamise kinnitust ei tule, siis PEAB mõne aja pärast saatmist uuesti üritama.</td>
</tr>
<tr>
  <td>7.7</td>
  <td>Tühipäringute arvu vähendamiseks PEAKS kasutada eksponentsiaalse taganemise (<em>exponential back-off</em>) algoritmi [EXP].</td>
</tr>
<tr>
  <td>7.7</td>
  <td>Saatmisürituste arv PEAB olema lõplik ja saatva süsteemi konfiguratsioonis määratav.</td>
</tr>
<tr>
  <td>8.1</td>
  <td>Vastuvõttev süsteem PEAB kontrollima, et dokument on saadetud õigele aadressile.</td>
</tr>
<tr>
  <td>8.1</td>
  <td>Vahendamise puhul PEAB vastuvõttev süsteem kontrollima, kas adressaat on vahendaja klient (on vahendusnimekirjas).</td>
</tr>
<tr>
  <td>8.2</td>
  <td>Valesti adresseeritud dokumendi korral PEAB vastuvõttev süsteem saatma saatjale veateate <code>Vale aadress</code>.</td>
</tr>
<tr>
  <td>8.3</td>
  <td>Vastuvõttev süsteem PEAB kontrollima, et dokument tuli nõuetekohases kapslis.</td>
</tr>
<tr>
  <td>8.3</td>
  <td>Kontroll PEAB sisaldama vähemalt XML skeemile vastavuse kontrollimist.</td>
</tr>
<tr>
  <td>8.3</td>
  <td>Vigase kapsli korral PEAB saatma vastava veateate <code>Vigane kapsel</code>.</td>
</tr>
<tr>
  <td>8.4</td>
  <td>Kui saatja DHS soovib dokumenti saata mitmele adressaadile (otsevõimekusega asutusele või vahendatavale asutusele) korraga, siis ta PEAB dokumendi kapsli saatma igale adresaadile eraldi, eraldi DHX <code>sendDocument</code> väljakutsega.</td>
</tr>
<tr>
  <td>8.5</td>
  <td>DHX-i võimekuse loonud süsteem PEAB üleminekuperioodil dokumente vastu võtma ka DVK-st.</td>
</tr>
<tr>
  <td>8.6</td>
  <td>Vastuvõttev süsteem PEAB kontrollima dokumendi kapslis sisalduvate saatjat kirjeldavate metaandmete ja X-tee päringsõnumi X-tee päiseväljade <code>client</code> ja <code>representedParty</code> kooskõlalisust. Lahknevuste korral PEAB dokumendi tagasi lükkama.</td>
</tr>
<tr>
  <td>8.6</td>
  <td>Vahendajalt dokumendi vastuvõtmisel PEAB kontrollima, kas vahendaja on vahendajate nimekirjas. Kontrolli tulemust VÕIB puhverdada.</td>
</tr>
<tr>
  <td>9.1</td>
  <td>Üleminekuperioodil niipea, kui asutuse DHS-is on tekkinud DHX protokolli võimekus (arendus on lõppenud), PEAB hakkama dokumendi saatmisel kasutama DHX teenust.</td>
</tr>
<tr>
  <td>9.1</td>
  <td>Üleminekuperioodil kui osutub, et adressaat ei ole veel dokumentide vastuvõtmise DHX-teenust loonud (teenus ei ole X-teel leitav), siis PEAB dokumendi saatma DVK kaudu, kasutades DVK teenust <code>sendDocument</code> ja märkides adressaadi dokumendi metaandmete kapslis.</td>
</tr>
<tr>
  <td>9.1</td>
  <td>DHX võimekuse saavutanud asutus PEAB DVK kasutamisest loobuma.</td>
</tr>
</tbody></table>

<h3 id="102-vahendajate-süsteemidele-rakenduvad-nõuded">10.2 Vahendajate süsteemidele rakenduvad nõuded</h3>

<table>
<thead>
<tr>
  <th>jaotis</th>
  <th>nõue</th>
</tr>
</thead>
<tbody><tr>
  <td>6.2</td>
  <td>Vahendajana tegutseda sooviv asutus või ettevõte PEAB end vahendajana X-teel registreerima.</td>
</tr>
<tr>
  <td>6.3</td>
  <td>Iga vahendaja PEAB pidama vahendusnimekirja.</td>
</tr>
<tr>
  <td>6.3</td>
  <td>Vahendaja PEAB hoidma vahendusnimekirja ajakohasena.</td>
</tr>
<tr>
  <td>6.3</td>
  <td>Vahendaja PEAB vahendusnimekirja tegema kättesaadavaks X-tee teenusena.</td>
</tr>
<tr>
  <td>6.3</td>
  <td>Vahendusnimekirja teenuse nimi PEAB järgima mustrit <code>EE/&lt;liikmeklass&gt;/&lt;registrikood&gt;/DHX/representationList</code>.</td>
</tr>
<tr>
  <td>6.3</td>
  <td>DHX-i rakendaja teostatud vahendusnimekirja teenus PEAB vastama lisas 2 esitatud täpsemale spetsifikatsioonile.</td>
</tr>
</tbody></table>

<h2 id="viited">Viited</h2>

<p>[AÜK] Vabariigi Valitsuse määrus „Asjaajamiskorra ühtsed alused“, <a href="https://www.riigiteataja.ee/akt/130122011062?leiaKehtiv">https://www.riigiteataja.ee/akt/130122011062?leiaKehtiv</a>.</p>

<p>[DVK] Dokumendivahetuskeskus (DVK). Riigi Infosüsteemi Amet. <a href="https://www.ria.ee/dokumendivahetus">https://www.ria.ee/dokumendivahetus</a>.</p>

<p>[DVK pidamise kord] Dokumendivahetuskeskuse pidamise kord. Riigi Infosüsteemi Amet. <a href="https://www.ria.ee/public/dvk_kord.pdf">https://www.ria.ee/public/dvk_kord.pdf</a>.</p>

<p>[DVK spetsifikatsioon] Dokumendivahetuskeskus (DVK). Liideste spetsifikatsioon 1.6.0.  <a href="https://svn.eesti.ee/projektid/dvk/doc/dvk_spetsifikatsioon_1.6.0.odt">https://svn.eesti.ee/projektid/dvk/doc/dvk_spetsifikatsioon_1.6.0.odt</a>.</p>

<p>[DH metaandmed] Dokumendihalduse metaandmed. Loend 3.0. Majandus- ja Kommunikatsiooniministeerium <a href="https://www.mkm.ee/sites/default/files/dokumendihalduse_metaandmed.pdf">https://www.mkm.ee/sites/default/files/dokumendihalduse_metaandmed.pdf</a>.</p>

<p>[EXP] Exponential backoff. <a href="https://en.wikipedia.org/wiki/Exponential_backoff">https://en.wikipedia.org/wiki/Exponential_backoff</a>.</p>

<p>[GOLANG] The Go Programming Language. <a href="https://golang.org/">https://golang.org/</a>.</p>

<p>[HTML5] HTML 5. Section 1.5.3 Extensibility. <a href='https://www.w3.org/TR/html/'>https://www.w3.org/TR/html/</a>.</p>

<p>[Kapsel] Elektroonilise andmevahetuse metaandmete loend 2.1. Riigi Infosüsteemi Amet.  <a href="https://riha.eesti.ee/riha/main/xml/elektroonilise_andmevahetuse_metaandmete_loend/1">https://riha.eesti.ee/riha/main/xml/elektroonilise_andmevahetuse_metaandmete_loend/1</a>.</p>

<p>[MIT] MIT License. <a href="https://github.com/e-gov/DHX/blob/master/LICENCE.txt">https://github.com/e-gov/DHX/blob/master/LICENCE.txt</a>.</p>

<p>[PR-GCONF] <a href="http://x-road.eu/docs/x-road_protocol_for_downloading_configuration.pdf">X-Road Protocol for Downloading Configuration</a>.</p>

<p>[PR-META] <a href="https://www.ria.ee/public/x_tee/pr-meta_x-road_service_metadata_protocol_2.1.3_Y-743-14.pdf">X-Road Service Metadata Protocol</a>.</p>

<p>[PR-MESS] <a href="http://x-road.eu/docs/x-road_message_protocol_v4.0.pdf">X-Road Message Protocol v4.0</a></p>

<p>[RIA-PP] <a href="https://github.com/e-gov/Open-Workflow/blob/master/ProtokollideParimPraktika.md">Protokollide spetsifitseerimise parim praktika</a>. Riigi Infosüsteemi Amet. 2015.</p>

<p>[RFC 2119] <a href="https://www.ietf.org/rfc/rfc2119.txt">Key words for use in RFCs to Indicate Requirement Levels</a>.</p>

<p>[RFC 2049] <a href="https://tools.ietf.org/html/rfc2049">RFC 2045 Multipurpose Internet Mail Extensions (MIME) Part One: Format of Internet Message Bodies</a>.</p>

<p>[RFC 6852] <a href="https://tools.ietf.org/html/rfc6852">RFC 6852 Affirmation of the Modern Paradigm for Standards</a>.</p>

<p>[SEMVER] <a href='http://semver.org/'>Semantic Versioning</a>.</p>

<p>[UG-SIGDOC] <a href="http://x-road.eu/docs/x-road_signed_document_download_and_verification_manual.pdf">X-Road: Signed Document Download and Verification Manual</a>. </p>

<p>[X-EXT] X-tee v6 sõnumiprotokolli kolmanda osapoole esindamise laiendus, <a href="https://www.ria.ee/public/x_tee/Third_party_representation_extension_v1.0.0.pdf">https://www.ria.ee/public/x_tee/Third_party_representation_extension_v1.0.0.pdf</a>.</p>

<p>[X-tee] Andmevahetuskiht X-tee, <a href="https://www.ria.ee/x-tee/">https://www.ria.ee/x-tee/</a>.</p>

<p>[X-tee määrus] Vabariigi Valitsuse määrus “Infosüsteemide andmevahetuskiht” (eelnõu 09.03.2016). </p>

<h2 id="lisa-1-senddocument-spetsifikatsioon">Lisa 1 sendDocument spetsifikatsioon</h2>

<p>Spetsifikatsioon asub <a href="https://github.com/e-gov/DHX/blob/master/files/sendDocument.md">eraldi failis</a>.</p>

<h2 id="lisa-2-representationlist-spetsifikatsioon">Lisa 2 representationList spetsifikatsioon</h2>

<p>Spetsifikatsioon asub <a href="https://github.com/e-gov/DHX/blob/master/files/representationList.md">eraldi failis</a>.</p>

<h2 id="lisa-3-muutelugu">Lisa 3 Muutelugu</h2>

<table>
<thead>
<tr>
  <th>versioon, kuupäev</th>
  <th>muudatus</th>
</tr>
</thead>
<tbody>
<tr>
  <td>1.0.3, 07.08.2016</td>
  <td>Täpsustatud teenuse <code>representationList</code> väljade koosseisu. Vt <a href='https://github.com/e-gov/DHX/blob/master/files/Ettepanek-07.md'>Ettepanek 07</a><br>
      Täpsustatud DVK tegutsemist DHX vahendajana üleminekuperioodil:<br>
      - joonisel 4 (üleminekuperiood) näidatud: teenuse <code>representationList</code> osutamine DVK poolt<br>
      - jaotise 7.5 muutmine kehtetuks
  </td>
</tr>	
<tr>
  <td>1.0.2, 05.09.2016</td>
  <td>Lisatud (jaotis 5.5) informatiivne märkus, mis käsitleb mitme alamsüsteemi kasutamist. Vt <a href='https://github.com/e-gov/DHX/blob/master/files/Ettepanek-04.md'>Ettepanek 04</a><br>
    Teenuse <code>sendDocument</code> spetsifikatsiooni täiendatud mittekohustusliku väljaga <code>recipientSystem</code>. Vt <a href='https://github.com/e-gov/DHX/blob/master/files/Ettepanek-05.md'>Ettepanek 05</a><br>
    Teenus <code>representationList</code> muudetud laiendatavaks, sarnaselt teenusele <code>sendDocument</code>. Vt <a href='https://github.com/e-gov/DHX/blob/master/files/Ettepanek-06.md'>Ettepanek 06</a>
  </td>
</tr>
<tr>
  <td>1.0.1, 30.08.2016</td>
  <td>Täpsustatud mitmele adressaadile saatmist. Vt <a href='https://github.com/e-gov/DHX/blob/master/files/Ettepanek-03.md'>Ettepanek 03</a></td>
</tr>
<tr>
  <td>1.0, 23.08.2016</td>
  <td>Esimene kinnitatud versioon. Lisatud mitut DHS-i toetav nimemuster. Vt <a href='https://github.com/e-gov/DHX/blob/master/files/Ettepanek-02.md'>Ettepanek 02</a></td>
</tr>
</tbody>
</table>

			</div>
		</div>
	</div>

</body>
</html>
